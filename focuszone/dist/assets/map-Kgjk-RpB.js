import{c as y,j as e,$ as m,a0 as g,a1 as j,r as d,a2 as v,a3 as w,a4 as b,a5 as P}from"./vendor-react-BUtKQChS.js";import{L as x,l as p}from"./vendor-leaflet-B36_YpXq.js";import{B as h}from"./cafelist-y6Oea1Uc.js";const a=y((s,r)=>({points:[],userLocations:null,carWaypoints:!0,walkWaypoints:!1,startPath:!1,time:0,length:"0",speed:"0",titlePlaces:[],setCarWaypoints:t=>{s({carWaypoints:t})},setWalkWaypoints:t=>{s({walkWaypoints:t})},setStartPath:t=>{s({startPath:t})},setPoints:t=>{const n=r().points;s({points:[...n,t]})},setTitlePlaces:t=>{const n=r().titlePlaces;s({titlePlaces:[...n,t]})},deletePoints:(t,n)=>{const c=r().points.filter(l=>l!==t);s({points:c}),n.stopPropagation()},setUserLocation:t=>{s({userLocations:t})},setTime:t=>{s({time:t})},setLength:t=>{s({length:t})},setSpeed:t=>{s({speed:t})}})),N="/assets/userNavigate-J5gU7lQw.png",W=()=>{const s=a(o=>o.points),r=a(o=>o.deletePoints),t=a(o=>o.userLocations),n=x.icon({iconUrl:N,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});return e.jsxs(e.Fragment,{children:[s.map((o,c)=>e.jsx(m,{position:o,children:e.jsx(g,{children:e.jsx("span",{className:"cursor-pointer",onClick:l=>r(o,l),children:"Удалить"})})},c)),t&&e.jsx(m,{position:t,icon:n,children:e.jsx(g,{children:e.jsx("span",{className:"cursor-pointer",children:"Вы здесь"})})})]})},L=({waypoints:s})=>{const r=j(),t=a(o=>o.setTime),n=a(o=>o.setLength);return d.useEffect(()=>{if(!r||!s||s.length<2)return;const o=s.map(l=>Array.isArray(l)?x.latLng(l[0],l[1]):x.latLng(l.lat,l.lng)),c=x.Routing.control({waypoints:o,lineOptions:{styles:[{color:"green",opacity:.6,weight:5}],extendToWaypoints:!0,missingRouteTolerance:20},router:x.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1",profile:"foot"}),show:!1,addWaypoints:!1,routeWhileDragging:!1}).addTo(r);return c.on("routesfound",l=>{const i=l.routes[0];if(!i)return;const u=(i.summary.totalDistance/1e3).toFixed(2),f=Math.round(i.summary.totalTime);t(f),n(u)}),()=>{r.removeControl(c)}},[r,s,t,n]),null},k=({waypoints:s})=>{const r=j(),t=a(o=>o.setTime),n=a(o=>o.setLength);return d.useEffect(()=>{if(!r||s.length<2)return;const o=p.Routing.control({waypoints:s.map(c=>p.latLng(c)),lineOptions:{styles:[{color:"blue",opacity:.6,weight:5}],extendToWaypoints:!0,missingRouteTolerance:20},router:p.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1"}),show:!1,addWaypoints:!1}).addTo(r);return o.on("routesfound",function(c){const i=(c.routes[0].summary.totalDistance/1e3).toFixed(2),u=Math.round(Number(i)/60*100);t(u),n(i)}),()=>{r.removeControl(o)}},[r,s]),null},M=({waypoints:s})=>{const r=a(o=>o.carWaypoints),t=a(o=>o.walkWaypoints),n=a(o=>o.startPath);return e.jsxs(e.Fragment,{children:[r&&n&&e.jsx(k,{waypoints:s}),t&&n&&e.jsx(L,{waypoints:s})]})},z=()=>{const s=a(n=>n.points),r=a(n=>n.deletePoints),t=a(n=>n.titlePlaces);return e.jsxs("div",{className:"h-[440px] flex flex-col gap-4 overflow-hidden",children:[e.jsx("h4",{children:"Список меток"}),e.jsx("div",{className:"flex-1 overflow-y-auto rounded-md border-2 border-zinc-200",children:s.map((n,o)=>e.jsxs("div",{className:" flex flex-col p-4",children:[e.jsxs("div",{className:"w-full flex gap-4 items-center justify-between",children:[e.jsx("span",{children:o+1}),e.jsxs("div",{children:[e.jsx("h6",{children:"Координаты:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("p",{className:"text-[12px]",children:n.lng.toFixed(4)}),e.jsx("p",{className:"text-[12px]",children:n.lat.toFixed(4)})]})]}),e.jsx(v,{className:"cursor-pointer",onClick:c=>r(n,c)})]}),t[o]=="Маркер"?e.jsxs("h4",{children:["Маркер ",o+1]}):e.jsx("h4",{children:t[o]}),e.jsx("span",{className:"h-[1px] w-full bg-zinc-900 mt-2"})]},o))})]})},T=({children:s})=>{const r=a(u=>u.setCarWaypoints),t=a(u=>u.setWalkWaypoints),n=a(u=>u.carWaypoints),o=a(u=>u.walkWaypoints),c=a(u=>u.setStartPath),l=()=>{r(!0),t(!1)},i=()=>{t(!0),r(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full h-full flex bg-black",children:[e.jsxs("div",{className:"w-2/10 max-h-full flex flex-col justify-between bg-white gap-4 p-4 border-r-2 border-zinc-900",children:[e.jsx(z,{}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center bg-zinc-200 p-2 rounded-lg",children:[e.jsx(h,{className:`w-1/2 rounded-r-none ${o?"bg-zinc-800":"bg-white text-zinc-900 hover:text-white"}`,onClick:()=>i(),children:"Пеший"}),e.jsx(h,{className:`w-1/2 rounded-l-none ${n?"bg-zinc-800":"bg-white text-zinc-900 hover:text-white"}`,onClick:()=>l(),children:"Машина"})]}),e.jsx(h,{children:"Моё местоположение"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h6",{children:"Запуск маршрута"}),e.jsxs("div",{className:"flex",children:[e.jsx(h,{className:"w-1/2 rounded-r-none",onClick:()=>c(!0),children:"Начать"}),e.jsx(h,{className:"w-1/2 rounded-l-none",onClick:()=>c(!1),children:"Закончить"})]})]})]})]}),s]})})},C=s=>{const r=Math.floor(s/3600),t=s%60;return{hour:r,minutes:t}},F=()=>{const s=a(i=>i.time),r=a(i=>i.length),t=a(i=>i.speed),[n,o]=d.useState(0),[c,l]=d.useState(0);return d.useEffect(()=>{const{hour:i,minutes:u}=C(s);o(i),l(u)},[s]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full flex bg-white justify-between p-4 border-t-2 border-zinc-900",children:[e.jsxs("div",{className:"bg-zinc-200 p-4 rounded-lg",children:[e.jsx("h5",{children:"Общая длина маршрута:"}),e.jsxs("h2",{children:[r," км"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"bg-zinc-200 p-4 rounded-lg",children:[e.jsx("h5",{children:"Время прохождения:"}),e.jsxs("h2",{children:[n," ч ",c," минут"]})]}),e.jsxs("div",{className:"bg-zinc-200 flex p-4 rounded-lg gap-2 items-center",children:[e.jsx("h4",{children:"Скорость:"}),e.jsxs("h4",{children:[t," км/ч"]})]})]})]})})},S=({children:s})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-9/10 h-[810px] flex flex-col relative border-zinc-900 border-2",children:[e.jsx(T,{children:s}),e.jsx(F,{})]})}),R=()=>{const s=a(c=>c.setPoints),r=a(c=>c.userLocations),t=a(c=>c.points),n=a(c=>c.setTitlePlaces),o=()=>(P({click(c){const l=c.latlng;s(l),n("Маркер")}}),null);return e.jsx(e.Fragment,{children:r&&e.jsx(S,{children:e.jsxs(w,{center:r,zoom:13,scrollWheelZoom:!0,style:{width:"80%",height:"100%"},children:[e.jsx(b,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(o,{}),e.jsx(W,{}),e.jsx(M,{waypoints:[r,...t]}),e.jsx("span",{className:"absolute bottom-0 right-0 w-[80px] h-[20px] z-[1100] bg-white",children:r.lng}),e.jsx("span",{className:"absolute bottom-5 right-0 w-[80px] h-[20px] z-[1100] bg-white",children:r.lat})]})})})},U=()=>{const s=a(t=>t.setUserLocation),r=a(t=>t.setSpeed);return d.useEffect(()=>{if(!navigator.geolocation){alert("Геолокация не поддерживается вашим браузером");return}const t=navigator.geolocation.watchPosition(n=>{const{latitude:o,longitude:c,speed:l}=n.coords,i=l!==null?(l*3.6).toFixed(2):"0";s({lat:o,lng:c}),r(i)},n=>{console.error("Ошибка геолокации:",n),alert("Не удалось определить местоположение")},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3});return()=>{navigator.geolocation.clearWatch(t)}},[s]),null},E=()=>{U();const s=a(n=>n.userLocations),r=a(n=>n.setUserLocation);d.useEffect(()=>{const n=setInterval(()=>{s!==null&&r(s)},5e3);return()=>{clearInterval(n)}},[]);const t=a(n=>n.userLocations);return e.jsx(e.Fragment,{children:t&&e.jsx("section",{className:"w-full h-full flex flex-col items-center justify-center my-10",children:e.jsx(R,{})})})};function A(){return e.jsx(e.Fragment,{children:e.jsx(E,{})})}const H=Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"}));export{H as p,a as u};
